<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body th:fragment="finput">
<style>
    .modern-input-wrapper {
        margin-bottom: 1.5rem;
    }
    .modern-form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: #212529;
        font-size: 0.95rem;
    }
    .modern-input {
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
        border: 1px solid #dee2e6;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    .modern-input:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .floating-label {
        position: relative;
    }
    .floating-label .form-control {
        height: calc(3.5rem + 2px);
        padding: 1rem 0.75rem;
    }
    .floating-label label {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        padding: 1rem 0.75rem;
        pointer-events: none;
        border: 1px solid transparent;
        transform-origin: 0 0;
        transition: opacity .1s ease-in-out, transform .1s ease-in-out;
    }
    .floating-label .form-control::-webkit-input-placeholder {
        color: transparent;
    }
    .floating-label .form-control:focus,
    .floating-label .form-control:not(:placeholder-shown) {
        padding-top: 1.625rem;
        padding-bottom: 0.625rem;
    }
    .floating-label .form-control:focus ~ label,
    .floating-label .form-control:not(:placeholder-shown) ~ label {
        opacity: .65;
        transform: scale(.85) translateY(-0.5rem) translateX(0.15rem);
    }
    .input-icon-wrapper {
        position: relative;
    }
    .input-icon-wrapper i {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        left: 1rem;
        color: #6c757d;
    }
    .input-icon-wrapper input {
        padding-left: 2.5rem;
    }
    .character-counter {
        position: absolute;
        right: 10px;
        bottom: -22px;
        font-size: 0.75rem;
        color: #6c757d;
    }
    .readonly-field {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }
</style>

<div class="modern-input-wrapper" th:remove="tag">
    <!-- Regular label style for non-floating labels -->
    <label th:if="${finputType} != 'hidden' and ${floating != true}"
           th:for="${finputName}"
           class="modern-form-label"
           th:utext="${finputText + (finputRequired==true ? ' <span class=&quot;text-danger&quot;>*</span>':'')}">
        Label Name
        <span class="text-danger">*</span>
    </label>

    <!-- Input with icon - modern design -->
    <div th:if="${finputIcon != null}" class="input-icon-wrapper">
        <i th:class="${finputIcon}"></i>
        <input
                th:name="${finputName}"
                th:id="${finputId != null ? finputId : finputName}"
                th:placeholder="'Enter ' + ${finputText}"
                th:required="${finputRequired==true}"
                th:class="'form-control modern-input' + ${(finputReadOnly==true ? ' readonly-field' : '')} + ${(finputClass==null?'':' '+ finputClass)}"
                th:type="${finputType}"
                th:field="*{__${finputName}__}"
                th:readonly="${finputReadOnly==true}"
                th:maxlength="${maxLength == null ? '255' : maxLength}"
                autocomplete="off"
        />
        <div class="character-counter" th:if="${finputReadOnly==false}">
            <span class="current-count">0</span>/<span class="max-count" th:text="${maxLength == null ? '255' : maxLength}">255</span>
        </div>
    </div>

    <!-- Floating label input style -->
    <div th:if="${finputIcon == null and floating == true}" class="form-floating mb-3">
        <input
                th:name="${finputName}"
                th:id="${finputId != null ? finputId : finputName}"
                th:placeholder="${finputText}"
                th:required="${finputRequired==true}"
                th:class="'form-control modern-input' + ${(finputReadOnly==true ? ' readonly-field' : '')} + ${(finputClass==null?'':' '+finputClass)}"
                th:type="${finputType}"
                th:field="*{__${finputName}__}"
                th:readonly="${finputReadOnly==true}"
                th:maxlength="${maxLength == null ? '255' : maxLength}"
                autocomplete="off"
        />
        <label th:for="${finputName}" th:text="${finputText}">Label Name</label>
        <div class="character-counter" th:if="${finputReadOnly==false}">
            <span class="current-count">0</span>/<span class="max-count" th:text="${maxLength == null ? '255' : maxLength}">255</span>
        </div>
    </div>

    <!-- Standard input without icon and without floating label -->
    <div th:if="${finputIcon == null and floating != true}" class="position-relative">
        <input
                th:name="${finputName}"
                th:id="${finputId != null ? finputId : finputName}"
                th:placeholder="'Enter ' + ${finputText}"
                th:required="${finputRequired==true}"
                th:class="'form-control modern-input' + ${(finputReadOnly==true ? ' readonly-field' : '')} + ${(finputClass==null?'':' '+finputClass)}"
                th:type="${finputType}"
                th:field="*{__${finputName}__}"
                th:readonly="${finputReadOnly==true}"
                th:maxlength="${maxLength == null ? '255' : maxLength}"
                autocomplete="off"
        />
        <div class="character-counter" th:if="${finputReadOnly==false}">
            <span class="current-count">0</span>/<span class="max-count" th:text="${maxLength == null ? '255' : maxLength}">255</span>
        </div>
    </div>

    <!-- Validation errors display with improved styling -->
    <div th:if="${#fields.hasErrors(finputName)}" class="invalid-feedback d-block mt-1">
        <i class="bi bi-exclamation-circle me-1"></i>
        <span th:errors="*{__${finputName}__}"></span>
    </div>

    <!-- JavaScript for enhanced functionality -->
    <script th:inline="javascript" th:if="${finputReadOnly==false}">
        document.addEventListener('DOMContentLoaded', function() {
            const inputId = [[${finputName}]];
            const input = document.getElementById(inputId);

            if (input) {
                // Character counter functionality
                const counterWrapper = input.parentElement.querySelector('.character-counter');
                if (counterWrapper) {
                    const currentCount = counterWrapper.querySelector('.current-count');
                    const maxCount = parseInt(counterWrapper.querySelector('.max-count').textContent);

                    // Update initial count
                    currentCount.textContent = input.value.length;

                    // Update count on input
                    input.addEventListener('input', function() {
                        currentCount.textContent = this.value.length;

                        // Color warning when approaching limit
                        if (this.value.length > maxCount * 0.8) {
                            counterWrapper.style.color = '#fd7e14'; // Warning orange
                        } else {
                            counterWrapper.style.color = '#6c757d'; // Default gray
                        }

                        // Color danger when at limit
                        if (this.value.length >= maxCount) {
                            counterWrapper.style.color = '#dc3545'; // Danger red
                        }
                    });
                }
            }

            // Check if Bootstrap 5 Maxlength plugin is available
            if (typeof $.fn.maxlength === 'function') {
                $('#' + inputId).maxlength({
                    alwaysShow: true,
                    warningClass: "badge bg-info",
                    limitReachedClass: "badge bg-danger"
                });
            }
        });
    </script>
</div>
</body>
</html>